



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Generated Templates - Modal Delete</title>
  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="text/javascript">
    // Check/Uncheck all individual checkboxes
    function selectAll(source) {
      const checkboxes = document.getElementsByName('delete[]');
      for (let i = 0; i < checkboxes.length; i++) {
        checkboxes[i].checked = source.checked;
      }
    }
  </script>
</head>
<body class="bg-gray-50 font-sans leading-normal tracking-normal">

  <!-- Main Container -->
  <div class="container mx-auto p-6">
    <div class="bg-white rounded-lg shadow-lg p-6">
      <h2 class="text-3xl text-center text-green-700 font-bold mb-6">Generated Templates</h2>
      <a href="{% url 'upload-page' %}" class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-700 transition">Upload</a>
        <br/>
        <br/>
      <form id="deleteSelectedForm" method="POST" action="{% url 'delete-selected' %}">
        {% csrf_token %}
        <div class="flex flex-col sm:flex-row justify-between items-center mb-4 space-y-4 sm:space-y-0">

          <!-- Button type="button" so we can intercept the click with JS -->
          <button type="submit" id="deleteSelectedButton" 
                  class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded">
            Delete Selected
          </button>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full bg-white">
                <thead>
                    <tr class="bg-green-600 text-white text-center"> <!-- Center header text -->
                        <th class="w-16 p-3">
                            <input type="checkbox" id="selectAllCheckbox" onchange="selectAll(this)"
                                class="form-checkbox h-5 w-5 text-blue-600">
                        </th>
                        <th class="p-3">Remarks</th>
                        <th class="p-3">Date of Generation</th>
                        <th class="p-3">Generated by</th>
                        <th class="p-3">Actions</th> <!-- Centered header -->
                    </tr>
                </thead>
                <tbody class="text-gray-700">
                    {% for item in dsr %}
                    <tr class="border-b hover:bg-gray-100 transition duration-150 text-center"> <!-- Center row content -->
                        <td class="p-3">
                            <input type="checkbox" name="delete[]" value="{{ item.instance }}"
                                class="form-checkbox h-5 w-5 text-blue-600" />
                        </td>
                        <td class="p-3">{{ item.remarks }}</td>
                        <td class="p-3">{{ item.date_of_generation }}</td>
                        <td class="p-3">{{ item.uploader }}</td>
                        <td class="p-3 flex justify-center space-x-2"> <!-- Flexbox for even spacing -->
                            <a href="{% url 'input-info' item.dsr.database %}"
                               class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-700 transition">Validate</a>
                            <a href="{% url 'generated-page' item.instance %}" 
                               class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-700 transition">View</a>
                            <a href="{% url 'delete-data' item.instance %}" 
                               class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-700 transition">Delete</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
        </div>
      </form>
      
    </div>
    
  </div>

   <!-- Validate Confirmation Modal -->
   <div id="validateModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex justify-center items-center hidden z-50">
    <div class="bg-white rounded-lg shadow-lg p-6 w-11/12 sm:w-1/3">
      <h2 class="text-xl font-bold mb-4">Confirm Validate</h2>
      <p class="mb-6">Are you sure you want to validate this item?</p>
      <div class="flex justify-end">
        <button id="cancelValidate" class="bg-gray-500 text-white px-4 py-2 rounded mr-2">Cancel</button>
        <button id="confirmValidate" class="bg-green-500 text-white px-4 py-2 rounded">Validate</button>
      </div>
    </div>
  </div>

  <!-- Individual Delete Modal -->
  <div id="deleteModal"
       class="fixed inset-0 bg-gray-900 bg-opacity-50 flex justify-center items-center hidden z-50">
    <div class="bg-white rounded-lg shadow-lg p-6 w-11/12 sm:w-1/3">
      <h2 class="text-xl font-bold mb-4">Confirm Delete</h2>
      <p class="mb-6">Are you sure you want to delete this item?</p>
      <div class="flex justify-end">
        <button id="cancelDelete"
                class="bg-gray-500 text-white px-4 py-2 rounded mr-2">Cancel</button>
        <button id="confirmDelete"
                class="bg-red-500 text-white px-4 py-2 rounded">Delete</button>
      </div>
    </div>
  </div>

  <!-- Delete Selected Modal -->
  <div id="deleteSelectedModal"
       class="fixed inset-0 bg-gray-900 bg-opacity-50 flex justify-center items-center hidden z-50">
    <div class="bg-white rounded-lg shadow-lg p-6 w-11/12 sm:w-1/3">
      <h2 class="text-xl font-bold mb-4">Confirm Delete Selected</h2>
      <p class="mb-6">Are you sure you want to delete the selected items?</p>
      <div class="flex justify-end">
        <button id="cancelDeleteSelected"
                class="bg-gray-500 text-white px-4 py-2 rounded mr-2">Cancel</button>
        <button id="confirmDeleteSelected"
                class="bg-red-500 text-white px-4 py-2 rounded">Delete</button>
      </div>
    </div>
  </div>

  <!-- No Selection Modal -->
  <div id="noSelectionModal"
       class="fixed inset-0 bg-gray-900 bg-opacity-50 flex justify-center items-center hidden z-50">
    <div class="bg-white rounded-lg shadow-lg p-6 w-11/12 sm:w-1/3">
      <h2 class="text-xl font-bold mb-4">No Items Selected</h2>
      <p class="mb-6">Please select at least one item to delete.</p>
      <div class="flex justify-end">
        <button id="closeNoSelectionModal"
                class="bg-blue-500 text-white px-4 py-2 rounded">
          OK
        </button>
      </div>
    </div>
  </div>


  <!-- Modal Script -->
  <script>
    // INDIVIDUAL DELETE MODAL
    let deleteUrl = "";
    const deleteModal = document.getElementById("deleteModal");
    const confirmDeleteButton = document.getElementById("confirmDelete");
    const cancelDeleteButton = document.getElementById("cancelDelete");

    document.querySelectorAll(".delete-link").forEach(link => {
      link.addEventListener("click", function(event) {
        event.preventDefault();  // Prevent immediate navigation
        deleteUrl = this.getAttribute("href");  // Store the URL for later use
        deleteModal.classList.remove("hidden");  // Show the modal
      });
    });

    confirmDeleteButton.addEventListener("click", function() {
      window.location.href = deleteUrl;
    });

    cancelDeleteButton.addEventListener("click", function() {
      deleteModal.classList.add("hidden");
      deleteUrl = "";
    });

    // Hide if user clicks outside the modal content
    deleteModal.addEventListener("click", function(e) {
      if (e.target === deleteModal) {
        deleteModal.classList.add("hidden");
        deleteUrl = "";
      }
    });

    // DELETE SELECTED MODAL
    const deleteSelectedButton = document.getElementById("deleteSelectedButton");
    const deleteSelectedModal = document.getElementById("deleteSelectedModal");
    const confirmDeleteSelectedButton = document.getElementById("confirmDeleteSelected");
    const cancelDeleteSelectedButton = document.getElementById("cancelDeleteSelected");
    const deleteSelectedForm = document.getElementById("deleteSelectedForm");

    // NO SELECTION MODAL
    const noSelectionModal = document.getElementById("noSelectionModal");
    const closeNoSelectionModalButton = document.getElementById("closeNoSelectionModal");

    // Check if any checkbox is selected
    deleteSelectedButton.addEventListener("click", function(event) {
      event.preventDefault();
      const selectedCheckboxes = document.querySelectorAll('input[name="delete[]"]:checked');
      if (selectedCheckboxes.length === 0) {
        // Show the "No Selection" modal
        noSelectionModal.classList.remove("hidden");
        return; // Stop here
      }
      // If we have at least one selected, show the standard "Delete Selected" modal
      deleteSelectedModal.classList.remove("hidden");
    });

    confirmDeleteSelectedButton.addEventListener("click", function() {
      deleteSelectedForm.submit();
    });

    cancelDeleteSelectedButton.addEventListener("click", function() {
      deleteSelectedModal.classList.add("hidden");
    });

    // Hide "Delete Selected" modal if user clicks outside
    deleteSelectedModal.addEventListener("click", function(e) {
      if (e.target === deleteSelectedModal) {
        deleteSelectedModal.classList.add("hidden");
      }
    });

    // CLOSE THE NO-SELECTION MODAL
    closeNoSelectionModalButton.addEventListener("click", function() {
      noSelectionModal.classList.add("hidden");
    });

    // Hide "No Selection" modal if user clicks outside it
    noSelectionModal.addEventListener("click", function(e) {
      if (e.target === noSelectionModal) {
        noSelectionModal.classList.add("hidden");
      }
    });

// ---- VALIDATE MODAL ----
let validateUrl = "";
    const validateModal = document.getElementById("validateModal");
    const confirmValidateButton = document.getElementById("confirmValidate");
    const cancelValidateButton = document.getElementById("cancelValidate");

    document.querySelectorAll(".validate-link").forEach(link => {
      link.addEventListener("click", function(event) {
        event.preventDefault(); // Prevent immediate navigation
        validateUrl = this.getAttribute("href"); // Store the URL for later use
        validateModal.classList.remove("hidden"); // Show the modal
      });
    });

    confirmValidateButton.addEventListener("click", function() {
      window.location.href = validateUrl;
    });

    cancelValidateButton.addEventListener("click", function() {
      validateModal.classList.add("hidden");
      validateUrl = "";
    });

    validateModal.addEventListener("click", function(e) {
      if (e.target === validateModal) {
        validateModal.classList.add("hidden");
        validateUrl = "";
      }
    });

  </script>
</body>
</html>
